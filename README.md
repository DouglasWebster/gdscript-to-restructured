# GDScript reStructuredText Docs Maker

This is a tool to document your Godot gdscript files into ***re*****Structured*****Text*** (..rst) files and to create an index of the generated files if required.

The code is based on the [gdscript-docs-maker code](https://github.com/GDQuest/gdscript-docs-maker) from [**GDQuest**](https://www.gdquest.com/) and, in as far as the initial stages of the conversion are concerned, it is a direct copy of their code with a few notable exceptions:
- This version only provides ***re*****Structured*****Text*** (.rst) output - if you require markdown or Hugo output then please follow the above link and use the original version.
- As there is no facility to create markdown or Hugo files the `-f/--format` and  `-a/--author` options in the original are no longer available.
- Multi-line comments in the code are concatenated to single line comments unless there are multiple  line breaks, in which case the line breaks are preserved.  This is to give, hopefully, a better flow of the description text.

## Installation

No installation is necessary if this is a fork of the repository otherwise you should install gdscript2rest from [PyPI](https://pypi.org)
 ## Additional requirements

In order to make the links from the Godot class names to the Godot API help files a link file has to be created and available to in the working directory of the program.  This can be accomplished by installing a small utility [godot-api-refs](https://pypi.org/project/godot-api-refs/) and running it in from the current working directory.

---
## Usage

The generation of the ***re*****Structured*****Text*** files is a two step process.

1. Create a JSON file that contains all the information extracted from your Godot project script files.
2. Turn each of the separate classes in the JSON file that contains a class_name qualifier into a separate ***re*****Structured*****Text*** file.


## Stage 1 - Create the JSON file

This is accomplished using the scripts available at [GDQuest gdscript-docs-maker](https://github.com/GDQuest/gdscript-docs-maker/tree/master/godot-scripts).  A copy of them is available in this repository under the godot-scripts folder but there is no guarantee that these scripts are up to date. For the latest use and for detailed instructions please refer to the original source repository.

Also included in this repository is the script generate_reference.  This is a bash script which has been copied from the GDQuest repository but has been altered to stop at producing the .json file. To use it enter
```
generate_reference $Godot-Project-Directory [options]
```
to create a file ***reference.json*** in the current working directory of your game project located in the ***$Godot-Project-Directory***

Run
```
generate_reference -h
```
To see a list of the options.  Please note that the -a and -f options do nothing in the enclosed version of the script.


## Stage 2 - Create the reStructuredText documents

To create the ***re*****Structured*****Text*** documents it is sufficient to run

``` 
python -m gdscript2rest $ReferenceFile.json
```
where $ReferenceFile.json is the path to the file created in Stage 1.  The program will output the files in a subdirectory called ***export***.

If you run 
```
python -m gdscript2rest -h
```

it will display the following which lists the options available to the program.
```
usage: gdscript2rest [-h] [-p PATH] [-i] [-v] [--dry-run] [-V] files [files ...]

Converts JSON data dumped by Godot's GDScript language server to create .rst files for 
use with Sphinx.

positional arguments:
  files                 A list of paths to JSON files.

optional arguments:
  -h, --help            show this help message and exit
  -p PATH, --path PATH  Path to the output directory.
  -i, --make-index      If this flag is present, create an index.rst page with a table of contents.
  -v, --verbose         Set the verbosity level. For example -vv sets verbosity to level 2. 
                        (Default: 0.)
  --dry-run             Run the script at max verbosity without creating files.
                        (For debugging purposes.)
  -V, --version         Print the version number and exit,
 --doc-version DOC_VERSION
                        Set the document version number if there is no version set in the JSON file. 
                        Defaults to 0.0.0
 ```

A fuller explanation of the options is:

* files :-> this is a list of files generated by ***generate-reference*** that is used as the input to the program
* -h --help :-> prints out the above usage statement and exits.
* -p PATH, --path PATH :-> outputs the reStructuredText files to PATH, this can be either an absolute or relative path
* -i :-> Creates an index file ***index.rst***.  This file is a very basic file with a single toctree entry that globs all the files in its directory
*  -v, --verbose :-> Prints out information as the program progresses.  Not over helpful but could aid in finding problems.
* --dry-run             Run the script at max verbosity without creating files. (For debugging purposes.)
*  -V, --version         Print the version number and exit,
* --doc-version DOC_VERSION :-> Unless I'm missing something Godot doesn't currently have the facility to store a version number so this gives the option to set the version number manually.  If not used the version number defaults to 0.0.0

## Further Information

The above instructions generate the ***re*****Structured*****Text*** files for documenting your project and for those of your familiar with reStructuredText and Sphinx then hopefully that is sufficient for your needs.  
For those of your that are unfamiliar with the format then the rest of this README is a basic primer on how to proceed to give yourself a professional looking document.

[***re*****Structured*****Text***](https://docutils.sourceforge.io/rst.html) is a markup language primarily created for documenting python code but is now widely used for many diverse projects.

[Sphinx](https://www.sphinx-doc.org/en/master/index.html) is a document generator tool that can take the ***re*****Structured*****Text*** text files and turn them into professional looking documents in a variety of formats; html, pdf. latex etc...

Sphinx should be installed following these instructions [Installing Sphinx](https://www.sphinx-doc.org/en/master/usage/installation.html) as the methods vary greatly by operating system and by type.

In this example I am using the [godot-design-patterns](https://github.com/GDQuest/godot-design-patterns) sample from GDQuest as a test project.

Once it is installed then I recommend creating a separate docs folder to hold the source documents and the output for your project documentation.  In a terminal change to your newly created docs folder and run 
```
shpinx-quickstart
```
 answering the questions asked (I normally opt for a separate source and build directories when asked as I find it easier to for things like .gitignore).  This will give you the basic scaffolding for a Sphinx project.

Once the basic scaffolding is done you should have the following folder structure:
```
sphinx-test/
┗ docs/
  ┣ source/
  ┃ ┣ _static/
  ┃ ┣ _templates/
  ┃ ┣ conf.py
  ┃ ┗ index.rst
  ┣ Makefile
  ┗ make.bat
```


First run
```
godot-api-refs
``` 
to generate the **godot_api_calls.json** which is required to create the reference links to the Godot help files for the Godot classes. This should only need to be run once per project.

Then create the reference.json file(s) required for your project with 
``` 
./generate-reference path-to-your-godot-project -o docs/source
``` 
which will give (***in my case using godot-design-patterns***) the following file structure with the 2 new JSON files required to generate the documentation:
```
sphinx-test/
┣ docs/
┃ ┣ source/
┃ ┃ ┣ _static/
┃ ┃ ┣ _templates/
┃ ┃ ┗ conf.py
┃ ┣ Makefile
┃ ┗ make.bat
┣ godot_api_calls.json
┗ reference.json
```


The create the ***re*****Structured*****Text*** files with 
```
python -m gdscript2rest reference.json -p docs/source -i
```
The -i will overwrite the index file with one that globs all the created API files.  This should give the following files structure w.
```
sphinx-test/
┣ docs/
┃ ┣ source/
┃ ┃ ┣ _static/
┃ ┃ ┣ _templates/
┃ ┃ ┣ BatteryEntity.rst
┃ ┃ ┣ Player.rst
┃ ┃ ┣ PlayerNoStates.rst
┃ ┃ ┣ PlayerState.rst
┃ ┃ ┣ PowerReceiver.rst
┃ ┃ ┣ PowerSource.rst
┃ ┃ ┣ PowerSystem.rst
┃ ┃ ┣ State.rst
┃ ┃ ┣ StateMachine.rst
┃ ┃ ┣ conf.py
┃ ┃ ┗ index.rst
┃ ┣ Makefile
┃ ┗ make.bat
┣ godot_api_calls.json
┗ reference.json
```
Change into the docs directory and run ```make html``` which will create the html files for your project documentation and give something like the following (the extraneous files in sources, _static etc, have been omitted):
```
sphinx-test/
┣ docs/
┃ ┣ build/
┃ ┃ ┣ doctrees/
┃ ┃ ┗ html/
┃ ┃   ┣ _sources/
┃ ┃   ┣ _static/
┃ ┃   ┣ .buildinfo
┃ ┃   ┣ BatteryEntity.html
┃ ┃   ┣ genindex.html
┃ ┃   ┣ index.html
┃ ┃   ┣ objects.inv
┃ ┃   ┣ Player.html
┃ ┃   ┣ PlayerNoStates.html
┃ ┃   ┣ PlayerState.html
┃ ┃   ┣ PowerReceiver.html
┃ ┃   ┣ PowerSystem.html
┃ ┃   ┣ PowerSource.html
┃ ┃   ┣ State.html
┃ ┃   ┣ search.html
┃ ┃   ┗ searchindex.js
┃ ┃   ┣ StateMachine.html
┃ ┣ source/
┃ ┃ ┣ _static/
┃ ┃ ┣ _templates/
┃ ┃ ┣ BatteryEntity.rst
┃ ┃ ┣ Player.rst
┃ ┃ ┣ PlayerNoStates.rst
┃ ┃ ┣ PlayerState.rst
┃ ┃ ┣ PowerReceiver.rst
┃ ┃ ┣ PowerSource.rst
┃ ┃ ┣ PowerSystem.rst
┃ ┃ ┣ State.rst
┃ ┃ ┣ StateMachine.rst
┃ ┃ ┣ conf.py
┃ ┃ ┗ index.rst
┃ ┣ Makefile
┃ ┗ make.bat
┣ godot_api_calls.json
┗ reference.json
```
If you now open the index.html page in a browser you should have a working copy of your API documentation but the external links are showing something like ```Extends: :godot_class:`Node2D <node2d>``` and don't do anything when clicked.  There will also have been several warning messages during the build.  This is because as it stands at the moment Sphinx does not know how to handle the external links.  In order for the external links to be active the conf.py file in the source dir has to be upgraded.

In conf.py change
```
extensions = [
]
```
to 
```
extensions = [
        "sphinx.ext.extlinks"
]
```
This enable external links using a shorthand link name.  Now add the following to conf.py bellow the ```extension``` section  to tell Sphinx where the shorthand name :godot_class: points to.
```
 extlinks = {
    'godot_class' : 
        ('https://docs.godotengine.org/en/stable/classes/class_%s.html', '')
}
```
Now, if you do ```make clean``` to get rid of the bad build followed by ```make html``` you should have a working copy of your documentation with all the external links active.
